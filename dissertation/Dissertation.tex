\documentclass[pdftex,12pt,a4paper,twoside]{article}

\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{amscd}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage[toc]{appendix}
\usepackage{fancyhdr}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage{pdfpages}
\usepackage{setspace}       % change padding
\usepackage{verbatim}       % verb newenvironment
\usepackage{wrapfig}
\usepackage{changepage}
\usepackage{url}            % clickable links
\usepackage{newclude}       % provides include for no clearpage
\usepackage{helvet}         % font
\usepackage{lipsum}         % placeholder text
\usepackage{pgfplots}       % gantt
\usepackage{listings}       % code listings
\usepackage{array}          % default column format
\usepackage[none]{hyphenat} % No broken words
\usepackage{ifthen}         % conditionals
\usepackage{changepage}     % modify lengths
\usepackage{subfig}         % multiple images in on figure
\usepackage{multirow}       % multiple table rows
\usepackage[export]{adjustbox}
\usepackage{pgfgantt}       % Gantt chart package
\usepackage{titlesec}       % section spacing

\titlespacing*{\subsection}{0pt}{1em}{0.5em}
\titlespacing*{\subsubsection}{0pt}{1em}{0.25em}

\usepackage[backend=biber,dateabbrev=false]{biblatex}
\addbibresource{diss.bib}
\DeclareFieldFormat{url}{\newline\mkbibacro{URL}\addcolon\nobreakspace\url{#1}}
%URL on new line

\makeatletter
\let\old@lstKV@SwitchCases\lstKV@SwitchCases
\def\lstKV@SwitchCases#1#2#3{}
\makeatother
\usepackage{lstlinebgrd}
\makeatletter
\let\lstKV@SwitchCases\old@lstKV@SwitchCases

\lst@Key{numbers}{none}{%
    \def\lst@PlaceNumber{\lst@linebgrd}%
    \lstKV@SwitchCases{#1}%
    {none:\\%
     left:\def\lst@PlaceNumber{\llap{\normalfont
                \lst@numberstyle{\thelstnumber}\kern\lst@numbersep}\lst@linebgrd}\\%
     right:\def\lst@PlaceNumber{\rlap{\normalfont
                \kern\linewidth \kern\lst@numbersep
                \lst@numberstyle{\thelstnumber}}\lst@linebgrd}%
    }{\PackageError{Listings}{Numbers #1 unknown}\@ehc}}
\makeatother

% Use the margin size here to adjust text width!
\usepackage[margin=3cm]{geometry}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows.meta, fit, matrix, positioning}

\tikzstyle{line} = [draw, -{Latex[length=5mm,width=3mm]}, line width=2pt]
\tikzstyle{thinline} = [draw, -{Latex[length=3mm,width=2mm]}, line width=1pt]

\tikzstyle{block} = [rectangle, draw, fill=blue!10,%black!10,
  text width=5em, text centered, rounded corners, minimum height=4em]
\tikzstyle{file} = [rectangle, draw, fill=blue!20,%black!20,
  minimum height=2em, text width=5em, text centered]
\tikzstyle{bin} = [circle, draw, fill=blue!30,%black!30,
  minimum height=3em, text width=5em, text centered, inner sep=0pt]

\tikzstyle{jblock} = [rectangle, draw, fill=red!20,%black!10,
  text width=5em, text centered, rounded corners, minimum height=4em]
\tikzstyle{jfile} = [rectangle, draw, fill=red!30,%black!20,
  minimum height=2em, text width=5em, text centered]
\tikzstyle{jbin} = [circle, draw, fill=red!40,%black!30,
  minimum height=3em, text width=5em, text centered, inner sep=0pt]

\tikzstyle{rblock} = [rectangle, draw, fill=green!20,%black!10,
  text width=5em, text centered, rounded corners, minimum height=4em]
\tikzstyle{rfile} = [rectangle, draw, fill=green!30,%black!20,
  minimum height=2em, text width=5em, text centered]
\tikzstyle{rbin} = [circle, draw, fill=green!40,%black!30,
  minimum height=3em, text width=5em, text centered, inner sep=0pt]

\tikzstyle{wfile} = [rectangle, draw, minimum height=2em, text width=5em, text centered]
\tikzstyle{wblock} = [rectangle, draw, text width=5em, text centered, rounded corners, minimum height=4em]

\fancyhf{}
\pagestyle{fancy}
\renewcommand{\headrulewidth}{0.2pt}
\renewcommand{\abstractname}{\vspace{-\baselineskip}}

% Styles can be Sonny, Lenny, Glenn, Conny, Rejne, Bjarne and Bjornstrup
\usepackage[Sonny]{fncychap}

\graphicspath{ {./figures/} }
\setlength{\parskip}{.5em}
\linespread{1.75}

\newcommand{\codelabel}[1]{
\vspace{-1em}
\begin{footnotesize}
  \hfill#1
\end{footnotesize}
}

\newcommand{\codeline}[2]{
\begin{adjustwidth}{-.5in}{-.5in}
 \begin{center}
 \lstinline{#1}

 \end{center}
\end{adjustwidth}

 \ifthenelse{\equal{#2}{}}
 {} %ignore if empty
 {
   \codelabel{#2}
 }
 \par
}

\newcommand{\pyline}[2]{
  \lstset{language=Python}
  \codeline{#1}{#2}
  \lstset{language=C}
}

\newcounter{mini}[subsubsection]

\newcommand{\minititle}[1]{\refstepcounter{mini}\vspace{\parskip}\hspace{-1\parindent}\textbf{~\themini. #1:}\\}

\newcommand{\tinytitle}[1]{\vspace{\parskip}\hspace{-1\parindent}\textbf{#1:}\hspace{3pt}}

\newcommand{\testresult}[2]{
\vspace{4pt}
\begin{adjustwidth}{-.5in}{-.5in}
  \begin{center}
   \setlength{\fboxsep}{1em}
   \fbox{%
    \parbox{\textwidth}{%
      \ifthenelse{\equal{#2}{pass}}
      {
        #1. The test is considered \textbf{\textcolor{green!20!black}{PASSED}}.
      }
      {
        #1 The test is considered \textbf{\textcolor{red!20!black}{FAILED}}.
      }
    }%
  }
  \end{center}
\end{adjustwidth}
\vspace{2pt}
}

\newenvironment{minipageparskip}
  {
   \begin{minipage}{.67\textwidth}% open the minipage
   \parskip 1em\relax% restore the value
   \parindent 1.5em\relax% restore the value
   \linespread{1.5}
  }
  {\end{minipage}}

\begin{document}

\lstset{language=C, basicstyle=\linespread{1.1}\ttfamily\footnotesize,
frame=tlbr,
backgroundcolor=\color{lightgray!15},
showspaces=false, showstringspaces=false,
commentstyle=\ttfamily\footnotesize\color{gray},
escapechar=|,
emph={
       cudaMalloc, cudaFree,
       __global__, __shared__, __device__, __host__,
       __syncthreads,
   }
}

%%TC:ignore
\include{Preamble/FrontPage}
\include{Preamble/Abstract}
\include{Appendices/Acknowledgements}
\include{Preamble/Contents}
\include{Preamble/ChapterMods}
%%TC:endignore

\include{Chapter1/Chapter1}
\include{Chapter2/Chapter2}
\include{Chapter3/Chapter3}
\include{Chapter4/Chapter4}
\include{Chapter5/Chapter5}
\include{Chapter6/Chapter6}
\include{Chapter7/Chapter7}

\newpage

%%TC:ignore
\printbibliography
\include{Appendices/Appendices}
%%TC:endignore

\end{document}
